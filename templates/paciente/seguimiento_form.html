{% extends 'base/base.html' %}

{% block title %} Formulario Paciente {% endblock %}
{% block content %}
{% if user.groups.all.0.name == 'Consultor' or object.glasgowtotal == 0 %}
<script type="text/javascript">
        window.location="{% url 'paciente_listar' %}";
</script>
{% endif %}

<form method="post">
    {% csrf_token %}

    <div class="row">


        <div class="col-md-8 col-md-offset-2">
                {% if form.errors %}
                    <!-- Error messaging -->
                    <div id="errors">
                        <div class="inner">
                            <p>There were some errors in the information you entered. Please correct the following:</p>
                            {{ form.non_field_errors }}
                            <ul>
                                {% for field in form %}
                                    {% if field.errors %}<li>{{ field.label }}: {{ field.errors|striptags }}</li>{% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <!-- /Error messaging -->
                {% endif %}
        </div>



        <div class="col-md-8 col-md-offset-2">
                <h1>Seguimiento Diario UCI Sujeto#{{ object.candidato.sujeto_numero|stringformat:"04d" }}</h1>
        </div>
        <div class="col-md-8 col-md-offset-2">
            <table class="table table-hover">
              <tbody>
                <tr class="table-active">
                  <th style="vertical-align:middle;">{{form.fechaseguimiento.label}}</th>
                    <td style="vertical-align:middle;">
                        {{ form.fechaseguimiento.errors }}
                        <input class="form-control"  min="{{object.candidato.uci.fechauci|date:'Y-m-d'}}" max="{{object.fechaseguimiento|date:'Y-m-d'}}" required name="fechaseguimiento" type="date" placeholder="Elegir fecha" id="id_fechauci" value="{{object.fechaseguimiento|date:'Y-m-d'}}">
                    </td>
                    <th>{{form.medico_responsable.label}}</th>
                    <td>{{form.medico_responsable}}</td>
                </tr>
                <tr>
                    <th colspan="2">Glasgow</th>
                    <th colspan="2">{{form.glasgowtotal.label}}</th>
                </tr>
                <tr>
                    <td>{{form.apertura_ocular.label}}</td>
                    <td>

                 {% for o in "1234"|make_list %}
                    <label onclick="sumar({{o}},'ocular')"  for="id_apertura_ocular_{{o}}">
                    <input type="radio" name="apertura_ocular" value="{{o}}"  required id="id_apertura_ocular_{{o}}"  {% if object.apertura_ocular == o %} checked="" {% endif %} />{{o}}
                  </label>
                  {% endfor %}
                  {{form.apertura_ocular.errors}}

                    </td>
                    <td colspan="2" colrow="3" style="vertical-align:middle;">
                    <input type="text" readonly name="glasgowtotal" placeholder="" size="3" required class="form-control" maxlength="3" id="id_glasgowtotal" value="{{object.glasgowtotal}}"/>
                    </td>
                </tr>
                <tr>
                    <td>{{form.respuesta_motora.label}}</td>
                    <td>

                          {% for o in "123456"|make_list %}
                            <label onclick="sumar({{o}},'motora')"  for="id_respuesta_motora_{{o}}">
                            <input type="radio" name="respuesta_motora" value="{{o}}"  required id="id_respuesta_motora_{{o}}"  {% if object.respuesta_motora == o %} checked="" {% endif %} />{{o}}
                          </label>
                          {% endfor %}
                          {{forms.respuesta_motora.errors}}

                    </td>
                </tr>
                <tr>
                    <td>{{form.respuesta_verbal.label}}</td>
                    <td>

                          {% for o in "12345"|make_list %}
                            <label onclick="sumar({{o}},'verbal')" for="id_respuesta_verbal_{{o}}">
                            <input type="radio" name="respuesta_verbal" value="{{o}}"  required id="id_respuesta_verbal_{{o}}"  {% if object.respuesta_verbal == o %} checked="" {% endif %} />{{o}}
                          </label>
                          {% endfor %}
                          {{forms.respuesta_verbal.errors}}

                    </td>
                </tr>
                <tr>
                    <th style="vertical-align:middle;">{{form.fallaorganica.label}}</th>
                    <td style="vertical-align:middle;">
                        <p><select name="fallaorganica" id="id_fallaorganica" required onchange="campo('id_fallaorganica_cual','falla','id_fallaorganica')">


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected >NO</option>

                        </select></p>
                        {{forms.fallaorganica.errors}}


                    </td>
                    <th style="vertical-align:middle;"><label style="visibility:hidden" id="falla">{{form.fallaorganica_cual.label}}</label></th>
                    <td style="vertical-align:middle;"><input type="hidden" name="fallaorganica_cual" required class="form-control" maxlength="25" id="id_fallaorganica_cual" /></td>
                    
                </tr>
                <tr>
                    <th style="vertical-align:middle;">{{form.infeccion.label}}</th>
                    <td style="vertical-align:middle;">
                        <p><select name="infeccion" id="id_infeccion" required onchange="campo('id_infeccion_foco','infeccion','id_infeccion')">


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected>NO</option>

                        </select></p>
                        {{forms.infeccion.errors}}


                    </td>
                    <th style="vertical-align:middle;"><label style="visibility:hidden" id="infeccion">{{form.infeccion_foco.label}}</label></th>
                    <td style="vertical-align:middle;"><input type="hidden" name="infeccion_foco" required class="form-control" maxlength="25" id="id_infeccion_foco" /></td>
                    
                </tr>
                <tr>
                    <th style="vertical-align:middle;">{{form.parada.label}}</th>
                    <td style="vertical-align:middle;">
                        <p><select name="parada" id="id_parada" required onchange="campo('id_parada_tiempo','parada','id_parada')">


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected>NO</option>

                        </select></p>
                        {{forms.parada.errors}}


                    </td>
                    <th style="vertical-align:middle;"><label style="visibility:hidden" id="parada">{{form.parada_tiempo.label}}</label></th>
                    <td style="vertical-align:middle;"><input type="hidden" name="parada_tiempo" required class="form-control" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/, '')" max="99" id="id_parada_tiempo" /></td>

                    
                </tr>
              <tr>
                    <th style="vertical-align:middle;">{{form.pic.label}}</th>
                    <td style="vertical-align:middle;">
                        <p><select name="pic" id="id_pic" required onchange="campo('id_pic_numero','pic','id_pic')">


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected>NO</option>

                        </select></p>
                        {{forms.pic.errors}}


                    </td>
                    <th style="vertical-align:middle;"><label style="visibility:hidden" id="pic">{{form.pic_numero.label}}</label></th>
                    <td style="vertical-align:middle;"><input type="hidden" name="pic_numero" required class="form-control" maxlength="2" oninput="this.value = this.value.replace(/[^0-9]/, '')" max="99" id="id_pic_numero" /></td>

                    
                </tr>
              <tr>
                    <th style="vertical-align:middle;">{{form.ventilacion.label}}</th>
                    <td colspan="3" style="vertical-align:middle;">
                        <p><select name="ventilacion" id="id_ventilacion" required >


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected>NO</option>

                        </select></p>
                        {{forms.ventilacion.errors}}


                    </td>

                    
                </tr>
              <tr>
                    <th style="vertical-align:middle;">{{form.soporte.label}}</th>
                    <td style="vertical-align:middle;">
                        <p><select name="soporte" id="id_soporte" required onchange="campo('id_soporte_cual','soporte','id_soporte')">


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected>NO</option>

                        </select></p>
                        {{forms.soporte.errors}}


                    </td>
                    <th style="vertical-align:middle;"><label style="visibility:hidden" id="soporte">{{form.soporte_cual.label}}</label></th>
                    <td style="vertical-align:middle;"><input type="hidden" name="soporte_cual" required maxlength="25" class="form-control" id="id_soporte_cual" /></td>

                    
                </tr>
                
                <tr>
                    <th style="vertical-align:middle;">{{form.neuroimagen.label}}</th>
                    <td style="vertical-align:middle;">
                        <p><select name="neuroimagen" id="id_neuroimagen" required >


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected >NO</option>

                        </select></p>
                        {{forms.neuroimagen.errors}}


                    </td>
                    <th style="vertical-align:middle;">{{form.neurologia.label}}</th>
                    <td style="vertical-align:middle;">
                        <p><select name="neurologia" id="id_neurologia" required >


                        <option  value="SI" >SI</option>

                        <option  value="NO" selected >NO</option>

                        </select></p>
                        {{forms.neurologia.errors}}


                    </td>

                    
                </tr>


                <tr>
                    <th style="vertical-align:middle;">{{form.midazolam.label}}</th>
                    <td style="vertical-align:middle;">
                        <input type="text" name="midazolam" required value="0" class="form-control" maxlength="20"  id="id_midazolam" />
                        {{forms.midazolam.errors}}
                    </td>
                    <th style="vertical-align:middle;">{{form.dexmedeto.label}}</th>
                    <td style="vertical-align:middle;">
                        <input type="text" name="dexmedeto" required value="0" class="form-control" maxlength="20"  id="id_dexmedeto" />
                        {{forms.dexmedeto.errors}}
                    </td>
                    

                </tr>
                
                <tr>
                    <th style="vertical-align:middle;">{{form.fentanyl.label}}</th>
                    <td style="vertical-align:middle;">
                        <input type="text" name="fentanyl" required value="0" class="form-control" maxlength="20"  id="id_fentanyl" />
                        {{forms.fentanyl.errors}}
                    </td>
                    <th style="vertical-align:middle;">{{form.tiopental.label}}</th>
                    <td style="vertical-align:middle;">
                        <input type="text" name="tiopental" required value="0" class="form-control" maxlength="20"  id="id_tiopental" />
                        {{forms.tiopental.errors}}
                    </td>
                    

                </tr>
                <tr>
                    <th style="vertical-align:middle;">{{form.vecuronio.label}}</th>
                    <td style="vertical-align:middle;">
                        <input type="text" name="vecuronio" required value="0" class="form-control" maxlength="20"  id="id_vecuronio" />
                        {{forms.vecuronio.errors}}
                    </td>
                    
                    

                </tr>


              </tbody>
            </table>
        </div>


    <div class="col-md-8 col-md-offset-2">
        <button class="btn btn-primary" type="submit">Guardar</button>
    </div>

    </div>
</form>


<br>
<br>
{% endblock %}
{% block extrajs %}


<script>
function sumar(a,b) {
    var ao1 =document.getElementById("id_apertura_ocular_1").checked ;
    var ao2 =document.getElementById("id_apertura_ocular_2").checked ;
    var ao3 =document.getElementById("id_apertura_ocular_3").checked ;
    var ao4 =document.getElementById("id_apertura_ocular_4").checked ;
    var rm1 =document.getElementById("id_respuesta_motora_1").checked ;
    var rm2 =document.getElementById("id_respuesta_motora_2").checked ;
    var rm3 =document.getElementById("id_respuesta_motora_3").checked ;
    var rm4 =document.getElementById("id_respuesta_motora_4").checked ;
    var rm5 =document.getElementById("id_respuesta_motora_5").checked ;
    var rm6 =document.getElementById("id_respuesta_motora_6").checked ;
    var rv1 =document.getElementById("id_respuesta_verbal_1").checked ;
    var rv2 =document.getElementById("id_respuesta_verbal_2").checked ;
    var rv3 =document.getElementById("id_respuesta_verbal_3").checked ;
    var rv4 =document.getElementById("id_respuesta_verbal_4").checked ;
    var rv5 =document.getElementById("id_respuesta_verbal_5").checked ;
    var total=0;
    if (b == 'ocular') {
    total = total+a+rm1*1+rm2*2+rm3*3+rm4*4+rm5*5+rm6*6+rv1*1+rv2*2+rv3*3+rv4*4+rv5*5;
    }
    if (b == 'motora') {
    total = total+a+ao1*1+ao2*2+ao3*3+ao4*4+rv1*1+rv2*2+rv3*3+rv4*4+rv5*5;
    }
    if (b == 'verbal') {
    total = total+a+ao1*1+ao2*2+ao3*3+ao4*4+rm1*1+rm2*2+rm3*3+rm4*4+rm5*5+rm6*6;
    }
    if (total > 7 ) {
    alert("El valor de Glasgow Total no puede ser mayor a 7 en sujetos que ya estan en el estudio.");
    var ao1 =document.getElementById("id_apertura_ocular_1").checked=false ;
    var ao2 =document.getElementById("id_apertura_ocular_2").checked=false ;
    var ao3 =document.getElementById("id_apertura_ocular_3").checked=false ;
    var ao4 =document.getElementById("id_apertura_ocular_4").checked=false ;
    var rm1 =document.getElementById("id_respuesta_motora_1").checked=false ;
    var rm2 =document.getElementById("id_respuesta_motora_2").checked=false ;
    var rm3 =document.getElementById("id_respuesta_motora_3").checked=false ;
    var rm4 =document.getElementById("id_respuesta_motora_4").checked=false ;
    var rm5 =document.getElementById("id_respuesta_motora_5").checked=false ;
    var rm6 =document.getElementById("id_respuesta_motora_6").checked=false ;
    var rv1 =document.getElementById("id_respuesta_verbal_1").checked=false ;
    var rv2 =document.getElementById("id_respuesta_verbal_2").checked=false ;
    var rv3 =document.getElementById("id_respuesta_verbal_3").checked=false ;
    var rv4 =document.getElementById("id_respuesta_verbal_4").checked=false ;
    var rv5 =document.getElementById("id_respuesta_verbal_5").checked=false ;
    total="";
    }

    document.getElementById("id_glasgowtotal").value = total;
}
</script>

<script>
function campo(a,b,c) {
    var x=document.getElementById(a);
    var y=document.getElementById(b);
    var z=document.getElementById(c).value;
    if (z == 'SI') {
        x.class='form-control';
        x.type='text';
        y.style="visibility:inline";
    } else {
        x.class='form-control';
        x.type='hidden';
        y.style="visibility:hidden";
        x.value="";
    }

}
</script>


{% endblock %}